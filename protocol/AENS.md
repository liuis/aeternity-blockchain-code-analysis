# Aeternity命名系统


## 摘要

本文档描述了Aeternity命名系统的初稿，简短的称为AENS。


## 动机

解决或识别大多数区块链系统的原生实体通过它们的哈希值，通常是以十六进制显示的“n”位数
或base64 / base58表示法，人们试图使用这些系统的时候所有这些都有点不友好。


## 背景

类似问题的解决方案是域名系统或DNS
应该为大多数人所熟悉，为IP提供人类可读的名称
地址。 DNS的问题在于它的集中化，
[Zooko]（https://en.wikipedia.org/wiki/Zooko%27s_triangle）表示
分散的系统在仍然存在时不能具有人类有意义的名称
安全。许多系统已经证明这个猜想是错误的，
一个例子是[NameCoin]（https://www.namecoin.org），它首次亮相
它允许用户将名称与一些键值相关联
对。 NameCoin网络今天仍然存在，但几乎看不到任何用法。

最近的一项努力是ENS，即以太坊名称服务，它为用户提供支持
通过一套智能合约索取名称。 ENS目前正在运行两个
年度试用部署，在此期间用户可以使用“.eth”声明名称
后缀，例如`mywallet.eth`。 ENS目前允许用户关联单个
带有节点的32字节数据数组，通常用于散列。


##概述

名称是名称空间的一部分，名称空间就像DNS一样工作，例如`mywallet.test`
或者`привет.test`是同一个`.test`命名空间的一部分。


##治理

AENS的初稿不会有任何治理机制，但是
只允许在单个命名空间下注册：`。test`。
我们也不会包括类似于`sunrise`和`landrush`的机制
对于DNS而言常见的期间，其中注册限制为小型
选择团体和商标持有人，以避免名字蹲下，之前
一般公众可以开始声称姓名。


##机制

目前还不清楚命名系统的好机制是什么
喜欢。如果我们想象两个演员都对同一个名字感兴趣，
什么是“公平”解决方案来解决这个问题？

费用是阻止垃圾邮件和抢注的主要机制。这个
初始版本将在没有帐户的情况下锁定治理费用
私钥访问，以使我们能够
在将来改变这种行为。如果我们开始这样做
对矿工来说，他们会非常犹豫地接受任何改变，其中
会对他们的收入产生负面影响。因此从[锁定]开始（共识/锁定.md）
可以让我们更容易地将来更新费用结构。

`.test`命名空间中的每个条目都支付相同的费用。

每个条目都有一个固定的索赔到期日期，之后条目应该是
过渡到“已撤销”状态。一旦达到这个状态，名称
将被释放，即过渡到“无人认领”状态，之后
它可以再次声称。

为了防止条目到期，用户可以在到达之前的任何时候
到期日期，更新条目，推送到期日期
通过注册时间和更新的时间增量来进入未来
时间，例如如果用户在声明其姓名后一周发布更新，
到期日期将进一步推迟到未来一周。
此失效日期的主要动机是防止出现这种情况
控制名称的私钥丢失，使名称无法使用
同样。


##规格

关键词“必须”，“绝不”，“必须”，“应该”，“不要”，“应该”，
本文档中的“不应该”，“推荐”，“可能”和“可选”应为
解释如[RFC 2119]（https://tools.ietf.org/html/rfc2119）中所述。


### AENS进入

这是应该由节点存储的条目。

```
  名称大小（字节）
 ------------ ----
|老板| 32 |
 ------------ ----
| expires_by | 32 |
 ------------ ----
| client_ttl | 8 |
 ------------ ----
|指针| |
 ------------ ----
```

***所有者***：控制此条目的帐户。

*** expires_by ***：条目进入之后的块高度
进入`已撤销'状态。这个值不得超过
未来将有50000个街区。

*** client_ttl ***：关于任何客户应该多久的建议
缓存此信息。 （*** TODO ***：应该有合理的
上限，例如86400秒，可能与众不同
名称不要与交易的一般TTL混淆）

此条目仅与客户相关且没有普查
影响。

***指针***：包含此条目所有值的字典
指向。
这可以有多个条目，例如付款地址相关联
使用名称和与名称关联的oracle地址。


＃＃＃ 名称

在散列之前，名称必须根据IDNA2008进行归一化，如
在[uts-46]（https://unicode.org/reports/tr46）中描述并且应该如此
以ASCII表示形式存储。
用于规范化和验证的参数是：

```
UseSTD3ASCIIRules =真
NontransitionalProcessing =真
CheckHyphens =真
CheckBidi = true＃对注册商很重要，限制名称
CheckJoiners = true＃对注册商很重要，限制名称
```

另见[rfc3491]（https://tools.ietf.org/html/rfc3491）和
[RFC3492]（https://tools.ietf.org/html/rfc3492）。

名称最多应为253个字符，以便启用
与DNS的互操作性。

***注意：***对于这个初稿，名称必须`.test`作为后缀，即`mywallet.test`。


###命名空间/标签

名称通过`FULL STOP（U + 002E。）`字符分成标签。
这些标签也将被称为名称空间，例如`mywallet.test`
可以理解为`aet`命名空间中的`mywallet`命名空间。

任何不在顶级的标签，例如`aet`，必须长于
三个字。

标签应该最多63个字符和完整路径
所有名称和命名空间应该最多253个字符
很长一段时间，以实现与DNS的互操作性。


###注册商

注册商控制谁可以在其名称空间中声明名称
在什么情况下允许他们这样做。

此AENS版本唯一可用的注册商将采用硬编码
那些拥有`.`和`.test`命名空间的。

`.`命名空间注册器受到限制，绝不允许任何人使用
声明其名称空间中的任何名称。

`.test`命名空间注册器允许用户声明任何名称
如果名称当前不是，则根据验证规则有效
声称他们支付适当的费用。


###承诺方案

声明一个名称需要一个承诺方案，使索赔人能够
承诺一个名字，并在承诺被接受后
链，揭示名称完成过程。

承诺应该具有约束力，即索赔人不能改变
他们承诺的价值，而不改变实际的承诺
并隐藏，以便恶意矿工不了解价值
索赔人已经承诺，直到他们选择透露这一价值。这个
防止恶意矿工在前面跑，即看到一个
索赔交易，包括他们自己的索赔请求
而不是原始索赔人的姓名。


### Hashing

我们将采用ENS中定义的`NameHash`
[EIP-137]（https://github.com/ethereum/EIPs/blob/master/EIPS/eip-137.md#namehash-algorithm）
使用Blake2b（256位摘要）代替。

```
def namehash（名字）：
  如果名称==''：
    返回'\ 0'* 32
  其他：
    label，_，remainder = name.partition（'。'）
    返回Blake2b（namehash（余数）+ Blake2b（标签））
```

名称通常仅以散列形式引用。


＃＃＃ 协议

```
                  到期
      无人认领<--------撤销
          | ^ ^^
          | | ||到期
          | |到期||
预先索赔| | || _
          | |撤销|| | |传递
          v | || | v
     预先声明------->声称
                  索赔| ^
                           | |
                             - 
                          更新
```

名称条目中的指针字段：
*在`claim`事务中，初始化为空字典。
*在`update`事务中，被事务中的指针替换，保持事务中的顺序。

请注意，`expire`不是明确的消息
协议。


####预先索赔

发送包含哈希承诺的“预先声明”事务。
此事务启动声明过程。

```
 ------------ ----
|承诺| 32 |
 ------------ ----
```

与区块链交互的客户应该生成警告
如果用户尝试声明不可用的名称。

“预先索赔”附加了隐含的到期日。一个
“预先索赔”必须在300个街区后被视为无效，即
大约两天，10分钟的阻止时间。

“预索赔”的哈希承诺计算如下：

```
承诺：=哈希（NameHash（name）+ name_salt）
```


＃＃＃＃ 要求

```
 ---------------- ----
|名字| 63 |
 ---------------- ----
| name_salt | 32 |
 ---------------- ----
```

用户流程：

1.（可选）等待`n`块，s.t。包括“预先索赔”的块不能反转
2.发送“索赔”交易以显示姓名并支付相关费用

如果'预索赔'和'索赔'的时间增量大于300块，
那么'索赔'必须被拒绝。

`claim`事务必须由与a相同的私钥签名
“预先索赔”交易，包含对名称和随机数的承诺。

一个`claim`事务绝不能包含在与它相同的块中
`预claim`。

“索赔”交易，除标准交易费外，
在受限制的帐户中锁定额外费用（没有私钥访问的帐户）。
另见[机制部分]（＃机制）。


####更新

```
 ------------ ----
|哈希| 32 |
 ------------ ----
| expire_by | 8 |
 ------------ ----
| client_ttl | 8 |
 ------------ ----
|指针| |
 ------------ ----
```

`update`事务必须由所有者签名
要更新的名称条目。

`expire_by`绝不能超过50000块
未来。

`update` transaction可用于扩展名称的租约。
我们不需要额外费用来延长租约。

`pointers`字段不应该包含具有相同键的多个条目。

####转移

```
 ------------ ----
|目标| 32 |
 ------------ ----
|哈希| 32 |
 ------------ ----
```

`transfer`交易必须由所有者签署
要转移的名称条目。


###撤销

```
 ------------ ----
|哈希| 32 |
 ------------ ----
```

撤销交易必须由所有者签署
名称条目。

在'revoke`事务已包含在链中之后，
名称进入“已撤销”状态。经过固定的超时后
2016块，该名称将再次申请。


##存储

我们将把AENS条目存储在ESMT中并使用
如上定义的名称的散列，作为指向条目数据的指针。
如果给定哈希没有条目，那么该指针将指向
否则，为空条目或该条目数据的哈希值。


##启动

为用户提供充足的时间来准备启动命名
鉴于分配规则，系统至关重要，即
这是初稿的先到先得。
这还包括为用户提供适当的工具，即GUI，
为了平衡谁能够实际上的比赛场地
注册名称。

由于我们还没有拍卖协议，我们可以坚持
在以太坊拍卖，以建立名称的初始分配，
就像我们的ERC-20令牌一样。


##（可能）未来扩展

###注册商

名称服务的更高版本应该允许每个用户成为
注册商并在智能合约中对其注册逻辑进行编码。
简化程序是注册服务商必须提交索赔
交易本身，只需将所有者设置为他们想要的人
给这个名字。

这些子标签允许进一步定制，也允许用户使用
与特定命名空间相关联，例如加密猫的繁殖
游戏可能会将名称条目与其中的每个猫关联起来，例如
`unicorn.kitty.test`然后将该名称转移给该人，谁
采用猫。这些授权政策需要一些
灵活性视为命名空间的所有者可能想要阻止
或允许用户创建子子标签，例如`unicorn.kitty.test`的所有者
创建`rarest .unicorn.kitty.test`。


###拍卖

使用（Vickrey）拍卖代替简单，先到先得
对于新索赔的第一次服务方法，可能会让更好
价格发现机制，无需经过
二级市场。


### URI Schema

我们目前使用与DNS相同的架构，可能
这是有问题的，因为这带来了很大的期望
至于能做什么和不能做什么。

请参阅[关于网址问题的帖子]（https://noncombatant.org/2017/11/07/problems-of-urls/）
或[此IPFS规范问题]（https://github.com/ipfs/specs/pull/152）
一些讨论。

###分散名称交换

在链上交换名称将使我们能够
以无信任的方式转移名称。加上出价
记录在链上也可以促进更好的价格发现。


###治理

允许用户注册自己的命名空间并成为
注册商自己，即如果我拥有`mywallet.aet`，我可以
然后允许其他人注册`name.mywallet.aet`。

考虑引入新TLD的投票机制。


###互操作性

 - 研究与ENS整合的可能性
 - 增加与https://ipld.io的互操作性
 - 添加对https://multiformats.io/multihash/的支持


###轻客户

轻客户可能只对历史感兴趣或
完整性特定名称因此需要一些轻量级
这种机制，目前是不可能的。


###费用彩票

有人建议`.aet`命名空间的费用可以
通过抽奖分发给随机账户。


##参考文献

[1] Kalodner，Harry A.，et al。 “对Namecoin的实证研究和分散命名空间设计的教训。” WEIS。 2015年。

[2] Ali，Muneeb，et al。 “Blockstack：由区块链保护的全球命名和存储系统。” USENIX年度技术会议。 2016年




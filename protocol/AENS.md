# Aeternity命名系统


## 摘要

本文档描述了Aeternity命名系统的初稿，简短的称为AENS。


## 动机

解决或识别大多数区块链系统的原生实体通过它们的哈希值，通常是以十六进制显示的“n”位数
或base64 / base58表示法，人们试图使用这些系统的时候所有这些都有点不友好。


## 背景

类似问题的解决方案是域名系统或DNS，大多数人都应该熟悉它，为IP地址提供人类可读的名称。 DNS的问题在于它的集中化，[Zooko](https://en.wikipedia.org/wiki/Zooko%27s_triangle)推测分散的系统在保持安全的同时不能拥有人性化的名称。 许多系统证明了这个猜想是错误的，其中一个例子是 [NameCoin](https://www.namecoin.org)，它于2011年首次亮相。它允许用户将名称与多个键值对相关联。 NameCoin网络今天仍然存在，但几乎看不到任何用法。

最近的一项努力是ENS，即以太坊名称服务，它使用户能够通过一组智能合约来声明名称。 ENS目前正在进行为期两年的试用部署，在此期间，用户可以使用.eth后缀声明名称，例如mywallet.eth。 ENS当前允许用户将单个32字节数据阵列与通常用于散列的节点相关联。


## 概述

名称是名称空间的一部分，名称空间就像DNS一样工作，例如`mywallet.test`
或者`привет.test`是同一个`.test`命名空间的一部分。


## 治理

AENS的初稿不会有任何治理机制，但只允许在单个命名空间下注册：.test。 我们也不会包括类似于sunrise和抢占期(landrush)的机制，这些机制在DNS中是常见的，其中注册仅限于小型选择组和商标持有者，以避免名称抢注，然后公众才能开始声明姓名。


## 机制

目前还不清楚命名系统的良好机制是什么样的。如果我们想象两个演员都对同一个名字感兴趣，那么解决这个问题的解决办法是什么呢？

费用是阻止垃圾邮件和抢注的主要机制。此初始版本将在没有私钥访问的帐户中锁定治理费用，以便我们将来能够更改此行为。如果我们开始向矿工提供这笔费用，他们会非常犹豫地接受任何改变，这将对他们的收入产生负面影响。因此，从锁定开始可以让我们更容易地将来更新费用结构。

.test命名空间中的每个条目都支付相同的费用。

每个条目都有一个固定的申请到期日期，之后条目应转换为撤销状态。一旦达到这种状态，名称将被释放，即转换到无人认领的状态，之后可以再次声明。

为了防止条目到期，用户可以在到达到期日期之前的任何时刻更新条目，该条目将到期日期推迟到登记时间和更新时间的时间增量，例如，如果用户在声明其姓名后一周发布更新，则到期日期会被推迟一周。此失效日期的主要动机是防止控制名称的私钥丢失，使名称也无法使用。


## 规格

关键词 "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", 和 "OPTIONAL" 在本文档中的解释和在 [RFC 2119](https://tools.ietf.org/html/rfc2119)中所诉的一样。


### AENS Entry

这是应该由节点存储的条目。

```
  名称大小（字节）
 ------------ ----
|owner| 32 |
 ------------ ----
| expires_by | 32 |
 ------------ ----
| client_ttl | 8 |
 ------------ ----
|指针| |
 ------------ ----
```

***owner***：控制此条目的帐户。

***expires_by***：条目进入之后的块高度进入`已撤销'状态。这个值不得超过
未来将有50000个blocks。

***client_ttl***：建议任何客户端应该缓存此信息多长时间。 （TODO：应该有一个合理的上限，例如86400秒，可能是一个不同的名称，不要与交易的一般TTL混淆）

此项仅适用于客户相关的，并没有conensus影响。

***指针***：包含此条目指向的所有值的字典。 这可以有多个条目，例如 与名称关联的付款地址和与名称关联的oracle地址。

### 名称 Name

在散列之前，名称必须根据IDNA2008进行归一化，如[uts-46](https://unicode.org/reports/tr46)中所述，并且应该以ASCII表示形式存储。 用于规范化和验证的参数是：

```
UseSTD3ASCIIRules =true
NontransitionalProcessing =true
CheckHyphens =true
CheckBidi = true＃对注册商registrars很重要，限制名称
CheckJoiners = true＃对注册商registrars很重要，限制名称
```

另见[rfc3491](https://tools.ietf.org/html/rfc3491)和[RFC3492](https://tools.ietf.org/html/rfc3492)。

名称最多应为253个字符，以便启用与DNS的互操作性。

***注意：***对于这个初稿，名称必须`.test`作为后缀，即`mywallet.test`。


### 命名空间/标签Labels

名称通过FULL STOP（U + 002E。）字符分割为标签。 这些标签也将被称为名称空间，例如 mywallet.test可以理解为aet命名空间中的mywallet命名空间。

任何不在顶级的标签，例如 aet，必须超过三个字符。

标签应该最多63个字符，并且所有名称和命名空间的完整路径最多应该是253个字符，以便实现与DNS的互操作性。


### 注册商

注册商控制谁可以在其名称空间中声明名称，以及在什么情况下允许他们这样做。

这个AENS版本唯一可用的注册商将是硬编码的，它们拥有 . 和 .test 名称空间。

 . 名称空间注册器受到限制，绝不允许任何人在其名称空间中声明任何名称。

.test名称空间注册器允许用户根据验证规则声明任何有效的名称，如果该名称当前未被声明并且他们支付适当的费用。


### 承诺方案

声明一个名称需要一个承诺方案，该方案使提出申请者能够提交一个名称，并且在承诺被接受到链中后，显示名称以完成该过程。

承诺应具有约束力，即提出申请者不能改变他们承诺的价值而不改变实际承诺和隐藏，以便恶意矿工在他们选择揭示该价值之前不了解申请人承诺的价值。 这可以防止恶意矿工在前面运行，即在看到申请交易时，包括他们自己的同名请求，而不是原始提出申请者的申请请求。


### Hashing

我们将采用ENS中定义的`NameHash`
[EIP-137]（https://github.com/ethereum/EIPs/blob/master/EIPS/eip-137.md#namehash-algorithm）
使用Blake2b（256位摘要）代替。

```
def namehash（name）：
  if name ==''：
    return'\ 0'* 32
  else：
    label，_，remainder = name.partition（'。'）
    return Blake2b（namehash（remainder）+ Blake2b（lable））
```

名称通常仅以散列形式引用。

### 协议

```
                  到期
      无人认领<--------撤销
          | ^ 				^^
          | | 				||到期
          | |到期			 ||
	预先申请 | | 				  ||  _
          | |			 撤销|| | |传递
          v | 				 || | v
         预先声明------->声称
                  申请| ^
                     | |
                      - 
                     更新
```

名称条目中的指针字段：

* 在`claim`事务中，初始化为空字典。
* 在`update`事务中，被事务中的指针替换，保持事务中的顺序。

请注意，`expire`不是明确的消息协议。


#### 预先申请

发送包含哈希承诺的“预先声明”事务。
此事务启动声明过程。

```
 ------------ ----
|承诺         | 32 |
 ------------ ----
```

与区块链交互的客户应该生成警告
如果用户尝试声明不可用的名称。

“预先申请”附加了隐含的到期日。一个
“预先申请”必须在300个Blocks后被视为无效，即
大约两天，10分钟的阻止时间。

“预申请”的哈希承诺计算如下：

```
commitment := Hash(NameHash(name) + name_salt)
```

### Claim 申请

```
 ---------------- ----
|name       | 63 |
 ---------------- ----
| name_salt | 32 |
 ---------------- ----
```

用户流程：

1.（可选）等待`n`块，s.t。包括“预先申请”的块不能反转
2.发送“申请”交易以显示姓名并支付相关费用

如果'预申请'和'申请'的时间增量大于300块，
那么'申请'必须被拒绝。

`claim`事务必须由与a相同的私钥签名
“预先申请”交易，包含对名称和随机数的承诺。

一个`claim`事务绝不能包含在与它相同的块中
`预claim`。

“申请”交易，除标准交易费外，
在受限制的帐户中锁定额外费用（没有私钥访问的帐户）。
另见[机制部分]（＃机制）。


#### 更新

```
 ------------ ----
|hash				| 32 |
 ------------ ----
| expire_by  | 8 |
 ------------ ----
| client_ttl | 8 |
 ------------ ----
|指针pointers	 | |
 ------------ ----
```

`update`事务必须由所有者签名
要更新的名称条目。

`expire_by`绝不能超过50000块
未来。

`update` transaction可用于扩展名称的租约。
我们不需要额外费用来延长租约。

`pointers`字段不应该包含具有相同键的多个条目。

#### 转移

```
 ------------ ----
|目标					| 32 |
 ------------ ----
|哈希					| 32 |
 ------------ ----
```

`transfer`交易必须由所有者签署
要转移的名称条目。


### 撤销

```
 ------------ ----
|哈希					| 32 |
 ------------ ----
```

撤销交易必须由所有者签署
名称条目。

在'revoke`事务已包含在链中之后，
名称进入“已撤销”状态。经过固定的超时后
2016块，该名称将再次申请。


## 存储

我们将把AENS条目存储在ESMT中并使用
如上定义的名称的散列，作为指向条目数据的指针。
如果给定哈希没有条目，那么该指针将指向
否则，为空条目或该条目数据的哈希值。


## 启动

为用户提供充足的时间来准备启动命名
鉴于分配规则，系统至关重要，即
这是初稿的先到先得。
这还包括为用户提供适当的工具，即GUI，
为了平衡谁能够实际上的比赛场地
注册名称。

由于我们还没有拍卖协议，我们可以坚持
在以太坊拍卖，以建立名称的初始分配，
就像我们的ERC-20令牌一样。


## （可能）未来扩展

### 注册商

名称服务的更高版本应允许每个用户成为注册商，并在智能合约中对其注册逻辑进行编码。 一个简化是注册服务商必须自己提交索赔交易，只需将所有者设置为他们想要提供名称的人。

这些子标签允许进一步定制，并且还允许用户与特定名称空间相关联，例如， 加密猫饲养游戏可能会将名称条目与其每只猫（例如unicorn.kitty.test）相关联，然后将该名称转移给采用该猫的人。 这些授权策略需要一定的灵活性，因为命名空间的所有者可能希望阻止或允许用户创建子子标签，例如， `unicorn.kitty.test`的所有者创建`rarest.unicorn.kitty.test`。


### 拍卖

使用（Vickrey）拍卖代替简单，先到先得对于新申请的第一次服务方法，可能会让更好
价格发现机制，无需经过二级市场。


### URI Schema

我们目前使用与DNS相同的架构，可能这是有问题的，因为这带来了很大的期望
至于能做什么和不能做什么。

请参阅[关于网址问题的帖子](https://noncombatant.org/2017/11/07/problems-of-urls/)或[此IPFS规范问题](https://github.com/ipfs/specs/pull/152)
一些讨论。

### 分散名称交换

在链上交换名称将使我们能够以无信任的方式转移名称。 此外，在链上记录出价也可以促进更好的价格发现。

### 治理

允许用户注册自己的命名空间并自己成为注册商，即如果我拥有mywallet.aet，我可以允许其他人注册name.mywallet.aet。

考虑引入新TLD的投票机制。


### 互操作性

 - 研究与ENS整合的可能性
 - 增加与https://ipld.io的互操作性
 - 添加对https://multiformats.io/multihash/的支持


### Light clients

轻客户可能只对历史感兴趣或完整性特定名称因此需要一些轻量级
这种机制，目前是不可能的。


### 费用彩票

有人建议`.aet`命名空间的费用可以通过抽奖分发给随机账户。


## 参考文献


[1] Kalodner, Harry A., et al. "An Empirical Study of Namecoin and Lessons for Decentralized Namespace Design." WEIS. 2015.

[2] Ali, Muneeb, et al. "Blockstack: A Global Naming and Storage System Secured by Blockchains." USENIX Annual Technical Conference. 2016.



